
VocÃª Ã© o agente tÃ©cnico responsÃ¡vel por executar e corrigir o MVP do sistema AffiBoard dentro do ambiente Replit.

A seguir estÃ¡ o contexto completo e o que vocÃª precisa fazer exatamente para deixar o MVP funcionando.

ðŸ”§ OBJETIVO PRINCIPAL

Corrigir, ajustar e ativar o MVP completo do AffiBoard, garantindo que:

1. O backend Express rode na porta 5000


2. O Vite frontend abra corretamente (sem bloqueio do host)


3. A comunicaÃ§Ã£o com o Supabase funcione


4. O dÃ©bito de crÃ©ditos e autenticaÃ§Ã£o funcionem


5. As rotas /api/analyze-mvp, /api/credits, /api/history funcionem


6. A anÃ¡lise via Edge Function seja substituÃ­da pela rota Express local


7. Todo o app seja acessÃ­vel pelo domÃ­nio pÃºblico do Replit (sem erro de host)




---

ðŸŸ© 1 â€” APLIQUE ESTE PATCH NO vite.config.ts

Corrija o erro de host bloqueado adicionando allowedHosts e configuraÃ§Ã£o de proxy.

FaÃ§a isso:

abrir vite.config.ts

adicionar:


server: {
  host: "0.0.0.0",
  port: 5173,
  allowedHosts: "all",
  proxy: {
    "/api": {
      target: "http://localhost:5000",
      changeOrigin: true,
      secure: false,
      ws: true,
      timeout: 100000
    }
  }
},

Remover qualquer duplicidade

Garantir que isso apareÃ§a dentro de defineConfig({ ... })


Depois, aplique o diff.


---

ðŸŸ© 2 â€” CRIAR OU ATUALIZAR AS ROTAS DO BACKEND (server/routes.ts)

Ative as 3 rotas do MVP:

âœ” /api/analyze-mvp

Recebe { url }

Valida JWT Supabase via header

Chama uma anÃ¡lise fake (temporÃ¡ria) para teste
â†’ Exemplo de resposta:


{
  "risk_score": 27,
  "conversion_score": 74,
  "recommendation": "Baixa concorrÃªncia, boa copy, pÃ¡gina rÃ¡pida"
}

âœ” /api/credits

Retorna os crÃ©ditos do usuÃ¡rio (consulta no Supabase)


âœ” /api/history

Retorna o histÃ³rico de anÃ¡lises do usuÃ¡rio
(consulta analysis_logs)



---

ðŸŸ© 3 â€” FRONTEND: AJUSTAR analyzeOffer()

No arquivo client/src/lib/api.ts:

Trocar a chamada antiga:

${import.meta.env.VITE_SUPABASE_URL}/functions/v1/analyze-offer-index-ts

Por:

"/api/analyze-mvp"

Usando fetch normal.


---

ðŸŸ© 4 â€” AJUSTAR CORS E RAW JSON NO BACKEND

Garantir que index.ts tenha:

express.json() configurado

middleware de logs ativo

Vite dev server em modo middleware

Servir estÃ¡tico em produÃ§Ã£o


SÃ³ confirmar que tudo estÃ¡ igual ao arquivo atual.


---

ðŸŸ© 5 â€” EXECUTAR TESTE AUTOMATIZADO (REPLIT)

Rodar o seguinte script criado aqui mesmo:

Crie test-mvp.ts com o seguinte conteÃºdo:

import fetch from "node-fetch";

(async () => {
  const base = "https://<INSIRA-O-SEU-DOMINIO-REPLIT>.replit.dev";

  console.log("ðŸ”Ž Testando API /api/analyze-mvp...");
  const res1 = await fetch(base + "/api/analyze-mvp", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ url: "https://exemplo.com" })
  });
  console.log(await res1.text());

  console.log("ðŸ”Ž Testando API /api/credits...");
  const res2 = await fetch(base + "/api/credits");
  console.log(await res2.text());
})();

Depois execute:

node test-mvp.ts

Se todas as respostas retornarem corretamente â†’ MVP OK.


---

ðŸŸ© 6 â€” PASSOS QUE VOCÃŠ (AGENTE) DEVE EXECUTAR EM ORDEM

1. Aplicar patch no vite.config.ts


2. Criar e aplicar as rotas no backend


3. Atualizar client/src/lib/api.ts


4. Rodar npm run dev


5. Testar se o domÃ­nio pÃºblico acessa o site


6. Caso ainda bloqueie host, imprimir o host exato e adicionar no Vite


7. Rodar o script de teste do MVP


8. Me retornar:

logs

diffs

confirmaÃ§Ã£o de funcionamento





---

ðŸŸ© 7 â€” APÃ“S FINALIZAR, RESPONDER COM:

MVP ATIVO
Rotas funcionando âœ”
Supabase OK âœ”
Credits system âœ”
Analyze MVP âœ”
DomÃ­nio habilitado âœ”

